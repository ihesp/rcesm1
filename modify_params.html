

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Modifying R-CESM parameters &mdash; RCESM Quickstart Guide and Development Doc</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="RCESM Quickstart Guide and Development Doc" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> RCESM Quickstart Guide and Development Doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_cesm.html">Downloading R-CESM</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start (R-CESM Model Workflow)</a></li>
<li class="toctree-l1"><a class="reference internal" href="rcesm_arch.html">R-CESM Modeling Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="io_files.html">R-CESM Input/Output Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="preprocessing.html">Creating a new R-CESM application/domain</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Porting R-CESM to new machines</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Known Issues and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="postprocessing.html">Post-processing Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="contribute.html">Contributing to RCESM</a></li>
<li class="toctree-l1"><a class="reference internal" href="updates.html">Future work and processes for updates</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">RCESM Quickstart Guide and Development Doc</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Modifying R-CESM parameters</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/modify_params.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="modifying-r-cesm-parameters">
<span id="modify-params"></span><h1>Modifying R-CESM parameters<a class="headerlink" href="#modifying-r-cesm-parameters" title="Permalink to this headline">¶</a></h1>
<p>All files required during R-CESM running phase are called input files and
files created by R-CESM during a run are called output files. Please note
that for models like ROMS configurable options are chosen during both
compilation and running phases. Since the source code always contain
files required during compilation stage, their list is not presented
here. But the important files for the compilation phase are discussed in
detail. Since the files needed during model running phase (for a new
experiment) are not available as a package like the R-CESM source code,
their list is presented for each component model. Again, most important
among these are discussed in detail. Please use the input files for the
Gulf of Mexico test case (Chapter <a class="reference external" href="#cha:qkstart">[cha:qkstart]</a>) as a
reference for setting up a new experiment. Only a basic description is
provided in this chapter and for information on tools and procedure for
creating some of these input files, please see Chapter
<a class="reference external" href="#cha:tools">[cha:tools]</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the model run involves many restart runs, keep the input files (for the running phase) which are invariant across the runs in a separate directory and make symbolic links in the run directory as required.</p>
</div>
<div class="section" id="roms-input-files">
<span id="sec-inpr"></span><h2>ROMS Input Files<a class="headerlink" href="#roms-input-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compilation-phase">
<span id="sec-inprcomp"></span><h3>Compilation Phase<a class="headerlink" href="#compilation-phase" title="Permalink to this headline">¶</a></h3>
<p>For the ROMS model, some of the scheme/parametrization choices are made
pre-compilation using header (file with ‘.h’ extension) files. File
txgla_3dnudg.h in src/R-CESM-1.0.0/ directory is the ROMS header file for
the Gulf of Mexico test case. A copy of the header file used during
compilation will be available in src ‘exec/include’ directory (Section
<a class="reference external" href="#sec:comp">[sec:comp]</a>).</p>
</div>
<div class="section" id="running-phase">
<span id="sec-inprrun"></span><h3>Running Phase<a class="headerlink" href="#running-phase" title="Permalink to this headline">¶</a></h3>
<p>For ROMS, the 3D nudging file is required only if the 3D nudging is
turned on (see Section <a class="reference external" href="#sec:3Dnudg">[sec:3Dnudg]</a>). All other files
are required for realistic configurations (ROMS do have the options to
provide grid, boundary and initial files through analytical functions
for idealized configurations). A list of ROMS input files are given in
Table <a class="reference external" href="#tab:inpR">[tab:inpR]</a>.</p>
<div class="section" id="ocean-in">
<h4>ocean.in<a class="headerlink" href="#ocean-in" title="Permalink to this headline">¶</a></h4>
<p>ROMS model options, including domain decomposition are specified in the
input file ocean.in. The total PE in ocean.in, computed as the product
of NtileI and NtileJ (eg. 16*24=384) should be same as ocn_tasks in
drv_in (&amp;ccsm_pes namelist) (see Section <a class="reference external" href="#sec:drvin">3.2.3</a>).</p>
</div>
</div>
</div>
<div class="section" id="wrf-input-files">
<span id="sec-inpw"></span><h2>WRF Input Files<a class="headerlink" href="#wrf-input-files" title="Permalink to this headline">¶</a></h2>
<p>WRF input netCDF and namelist files are listed in Table
<a class="reference external" href="#tab:inpW">[tab:inpW]</a>, which are mandatory for all cases.</p>
<p>required only for restart runs.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 6%" />
<col style="width: 28%" />
<col style="width: 19%" />
<col style="width: 48%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>#</p></td>
<td><p>Filename</p></td>
<td><p>File Type</p></td>
<td><p>Description</p></td>
</tr>
<tr class="row-even"><td><p>1</p></td>
<td><p>wrfinput_d01.nc</p></td>
<td><p>netCDF</p></td>
<td><p>Grid file</p></td>
</tr>
<tr class="row-odd"><td><p>2</p></td>
<td><p>wrflowinp_d01</p></td>
<td><p>netCDF</p></td>
<td><p>Lower boundary conditions</p></td>
</tr>
<tr class="row-even"><td><p>3</p></td>
<td><p>wrfbdy_d01</p></td>
<td><p>netCDF</p></td>
<td><p>Lateral boundary conditions</p></td>
</tr>
<tr class="row-odd"><td><p>4</p></td>
<td colspan="3"><p>#atm.r.2010-01-04.∗.nc |   netCDF    |  WRF restart files</p></td>
</tr>
<tr class="row-even"><td><p>5</p></td>
<td><p>namelist.input</p></td>
<td><p>txt</p></td>
<td><p>WRF namelist/options file</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>Please adapt the namelist.input file provided with Gulf of Mexico test
case for a new application rather than using namelist.input file
available with independant WRF distribution. Please note that the domain
decomposition (processor tiling) is automatically determined by R-CESM
and there is no field in namelist.input to control this aspect for the
WRF component. Please see Section <a class="reference external" href="#sec:drvin">3.2.3</a> for details
about processor specifying options for R-CESM.</p>
</div>
<div class="section" id="r-cesm-coupler-input-files">
<span id="sec-inpc"></span><h2>R-CESM/Coupler Input Files<a class="headerlink" href="#r-cesm-coupler-input-files" title="Permalink to this headline">¶</a></h2>
<p>All of the required configuration options for an experiment with the RCESM are encapsulated in XML variables within various files in the case directory. While it is possible to edit these files directly, it is recommended that users use the <code class="docutils literal notranslate"><span class="pre">xmlquery</span></code> and <code class="docutils literal notranslate"><span class="pre">xmlchange</span></code> scripts to view and modify the value of these variables.</p>
<p>As an example, the model is set to run for 5 days by default. This is controlled by the <code class="docutils literal notranslate"><span class="pre">$STOP_N</span></code> and
<code class="docutils literal notranslate"><span class="pre">$STOP_OPTION</span></code> variables. To view the current values of these variables, use the <code class="docutils literal notranslate"><span class="pre">xlmquery</span></code> command</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlquery STOP_OPTION,STOP_N</span>
</pre></div>
</div>
<p>The <strong>Gulf of Mexico example</strong> from above has mostly been tested for this 30 day period. If you wanted to run it for a period of three months, you can use <code class="docutils literal notranslate"><span class="pre">xmlchange</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">./xmlchange STOP_OPTION=nmonths,STOP_N=3</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>The advantage of using <code class="docutils literal notranslate"><span class="pre">xmlchange</span></code> compared to manually editing the XML config files are 1. The input values are automatically checked for errors before the variable is modified. 2. Each call to <code class="docutils literal notranslate"><span class="pre">xmlchange</span></code> is logged in the <code class="docutils literal notranslate"><span class="pre">CaseStatus</span></code> file so that we can keep track of all our changes from the default in any given experiment.</p>
<p>CESM xml variables are fully documented in the CESM2.1 release documents.  Here is a short compilation of variables that may be useful in testing or running RCESM experiments.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 17%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>XML Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>PROJECT</p></td>
<td><p>Account project number to charge compute time to</p></td>
</tr>
<tr class="row-odd"><td><p>JOB_QUEUE</p></td>
<td><p>Which queue to submit a job, if different than default</p></td>
</tr>
<tr class="row-even"><td><p>JOB_WALLCLOCK_TIME</p></td>
<td><p>Wall time to request for a job</p></td>
</tr>
<tr class="row-odd"><td><p>STOP_OPTION</p></td>
<td><p>What units to use for the specified run length. Valid values: nsteps, ndays, nmonths, nyears</p></td>
</tr>
<tr class="row-even"><td><p>STOP_N</p></td>
<td><p>The number of STOP_OPTION units that the experiment will complete</p></td>
</tr>
<tr class="row-odd"><td><p>RUN_STARTDATE</p></td>
<td><p>The date on which the experimental run begins</p></td>
</tr>
<tr class="row-even"><td><p>DEBUG</p></td>
<td><p>Whether to compile the model with debug flags on</p></td>
</tr>
<tr class="row-odd"><td><p>DOUT_S</p></td>
<td><p>Turns archiving of history and restart files on (TRUE) or off (FALSE)</p></td>
</tr>
<tr class="row-even"><td><p>DIN_LOC_ROOT</p></td>
<td><p>Location of the input data directory structure</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The rpointer here means “restart pointer” which informs R-CESM about
restart date and time. There are 5 rpointer files, one for each
component as shown below:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 27%" />
<col style="width: 73%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>atmosphere/WRF:</p></td>
<td><p>rpointer.atm</p></td>
</tr>
<tr class="row-even"><td><p>data ocean:</p></td>
<td><p>rpointer.docn</p></td>
</tr>
<tr class="row-odd"><td><p>driver/coupler:</p></td>
<td><p>rpointer.drv</p></td>
</tr>
<tr class="row-even"><td><p>ROMS:</p></td>
<td><p>rpointer.roms</p></td>
</tr>
<tr class="row-odd"><td><p>ocean:</p></td>
<td><p>rpointer.ocn (symbolic link to rpointer.roms)</p></td>
</tr>
</tbody>
</table>
<p>Please note that the time format for these files are different (like
2010-01-04_00_00_00 for atm and 2010-01-04-00000 for drv). The
rpointer.drv file use acronym cpl in it (like
TXGLO.cpl.r.2010-01-04-00000.nc) instead of drv. Also there are two
entries for the rpointer.docn and other have just one entry. The usage
details of rpointer files are listed below.</p>
<p>For the very first run from initial condition files, set the entries in
all rpointer files to expected restart date.</p>
<p>For all successfull runs, the rpointer files are automatically updated
with the most recet restart date and time.</p>
<p>If you intend to continue a run from most recent restart files, just
these updated rpointer files to the restart run directory.</p>
<p>If you are making restart run from a different restart file, please
update the rpointer files accordingly.</p>
<p>For restart runs, the first entry in rpointer files should correspond to
the restart date and time.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">TXGLO</span><span class="o">.</span><span class="n">atm</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="mi">2010</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mf">20_00_00_00.</span><span class="n">nc</span>
<span class="n">TXGLO</span><span class="o">.</span><span class="n">atm</span><span class="o">.</span><span class="n">r</span><span class="o">.</span><span class="mi">2010</span><span class="o">-</span><span class="mi">04</span><span class="o">-</span><span class="mf">30_00_00_00.</span><span class="n">nc</span>
</pre></div>
</div>
<p>Please note that the restart file writing frequency is not determined by
rpointer files but by the value of “restart_n” in drv_in (see Section
<a class="reference external" href="#sec:rstfr">[sec:rstfr]</a> for details).</p>
<p>The syntax for years in the streams entry of “docn_ocn_in” is as
follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">streams</span> <span class="o">=</span> <span class="s2">&quot;docn.streams.txt.prescribed YrAlign yrFirst yrLast&quot;</span>
</pre></div>
</div>
<p>It appears that the YrAlign should be same as YrFirst always!!!!!</p>
<p>The number of processors/cores (PEs) for running R-CESM and its component
models should be clearly mentioned in drv_in (&amp;ccsm_pes namelist). If
drv_in is edited to update PE count or layout, pleae edit the ocean.in
(Section <a class="reference external" href="#sec:nlistR">1.2.5</a>) and run_R-CESM.job file (Section
<a class="reference external" href="#sec:jobfl">4.1</a>) accordingly. Please note that the total number of
PEs are devided between atm_ntasks and ocn_ntasks. Also, atm_rootpe is 0
and ocn_rootpe is same as atm_ntasks. All other component model mirrors
the settings for the atm. Two examples for total PE counts of 552 and
120 are provided in Table <a class="reference external" href="#tab:pe">[tab:pe]</a>.</p>
<p>sum of number of atm model PE (atm_ntasks) and ocn model PE
(ocn_ntasks). Please note that the root PE for atm is 0 and that for ocn
in atm_ntasks. Other component models mirror atm model settings.</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p>ccsm_pe</p></td>
<td><p>Total</p></td>
<td><p>Total</p></td>
</tr>
<tr class="row-even"><td><p>field</p></td>
<td><p>PE=552</p></td>
<td><p>PE=120</p></td>
</tr>
<tr class="row-odd"><td><p>atm_ntasks</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>atm_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>atm_rootpe</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>atm_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>atm_layout</p></td>
<td><p>‘concurrent’</p></td>
<td><p>‘concurrent’</p></td>
</tr>
<tr class="row-even"><td><p>lnd_ntasks</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-odd"><td><p>lnd_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>lnd_rootpe</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>lnd_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>lnd_layout</p></td>
<td><p>‘concurrent’</p></td>
<td><p>‘concurrent’</p></td>
</tr>
<tr class="row-odd"><td><p>ocn_ntasks</p></td>
<td><p>384</p></td>
<td><p>80</p></td>
</tr>
<tr class="row-even"><td><p>ocn_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>ocn_rootpe</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>ocn_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>ocn_layout</p></td>
<td><p>‘concurrent’</p></td>
<td><p>‘concurrent’</p></td>
</tr>
<tr class="row-even"><td><p>ice_ntasks</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-odd"><td><p>ice_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>ice_rootpe</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>ice_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>ice_layout</p></td>
<td><p>‘concurrent’</p></td>
<td><p>‘concurrent’</p></td>
</tr>
<tr class="row-odd"><td><p>glc_ntasks</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-even"><td><p>glc_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>glc_rootpe</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p>glc_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-odd"><td><p>glc_layout</p></td>
<td><p>‘concurrent’</p></td>
<td><p>‘concurrent’</p></td>
</tr>
<tr class="row-even"><td><p>cpl_ntasks</p></td>
<td><p>168</p></td>
<td><p>40</p></td>
</tr>
<tr class="row-odd"><td><p>cpl_nthreads</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
<tr class="row-even"><td><p>cpl_rootpe</p></td>
<td><p>0</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p>cpl_pestride</p></td>
<td><p>1</p></td>
<td><p>1</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>This file provides path and filenames for the domain info file (eg.
domain.txglo.nc) and the xROMS sea surface temperature (SST) and ice
fields (eg. <span class="math notranslate nohighlight">\(*\)</span>_xroms_sstice.nc). Please update the value for
“&lt;filePath&gt;” and “&lt;fileNames&gt;” for both “&lt;domainInfo&gt;” and “&lt;fieldInfo&gt;”
entries as appropriate.</p>
<span class="target" id="sec-map"></span></div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

<div class="row" style="display: flex">
  <div class="column" style=" flex: 15.33%;padding: 10px;">
    <img src="_images/tamu-logo-rgb.svg" alt="Snow" style="width:100%">
  </div>
  <div class="column" style=" flex: 7.33%;padding: 10px;">
    <img src="_images/ihesp-logo-rgb.svg" alt="Forest" style="width:100%">
  </div>
  <div class="column" style=" flex: 9.33%;padding: 10px;">
    <img src="_images/2017_06_ncar_highres_transparent.png" alt="Mountains" style="width:100%">
  </div>
</div>



  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, sphinx-themes.org.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Stanford-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/language_data.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>